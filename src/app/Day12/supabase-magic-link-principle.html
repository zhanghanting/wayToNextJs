<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase é‚®ç®±é­”é“¾ç™»å½•åŸç†è¯¦è§£</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section h2 {
            font-size: 1.8rem;
            color: #2d3748;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
            padding-left: 15px;
        }
        
        .section h3 {
            font-size: 1.4rem;
            color: #4a5568;
            margin: 30px 0 15px 0;
        }
        
        .analogy-box {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .analogy-box h4 {
            color: #2c7a7b;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .chart-container {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8fafc;
        }
        
        .highlight-box {
            background: #fff5f5;
            border: 2px solid #fc8181;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success-box {
            background: #f0fff4;
            border: 2px solid #68d391;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning-box {
            background: #fffbf0;
            border: 2px solid #f6e05e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .step-list {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .step-list ol {
            padding-left: 20px;
        }
        
        .step-list li {
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .emoji {
            font-size: 1.2em;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
        }
        
        /* Mermaid diagram styling */
        .mermaid {
            text-align: center;
            margin: 20px 0;
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .header {
                background: #667eea !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="emoji">ğŸ”</span> Supabase é‚®ç®±é­”é“¾ç™»å½•åŸç†è¯¦è§£</h1>
            <p>æ·±å…¥ç†è§£ç°ä»£èº«ä»½è®¤è¯çš„æœ€ä½³å®è·µ</p>
        </div>
        
        <div class="content">
            <!-- ç”Ÿæ´»ç±»æ¯” -->
            <div class="section">
                <h2><span class="emoji">ğŸ </span> ç”Ÿæ´»ç±»æ¯”ï¼šé­”é“¾ç™»å½•å°±åƒæ”¶å¿«é€’</h2>
                
                <div class="analogy-box">
                    <h4><span class="emoji">ğŸ“¦</span> ç½‘è´­æ”¶å¿«é€’çš„è¿‡ç¨‹ï¼š</h4>
                    <ol>
                        <li><span class="emoji">ğŸ“±</span> ä½ åœ¨ç½‘ç«™<strong>è¾“å…¥æ”¶è´§åœ°å€</strong>ï¼ˆé‚®ç®±ï¼‰</li>
                        <li><span class="emoji">ğŸšš</span> å¿«é€’å‘˜<strong>é€åŒ…è£¹åˆ°ä½ å®¶</strong>ï¼ˆå‘é€é­”é“¾é‚®ä»¶ï¼‰</li>
                        <li><span class="emoji">ğŸ“¦</span> ä½ <strong>ç­¾æ”¶å¿«é€’</strong>ï¼ˆç‚¹å‡»é‚®ä»¶ä¸­çš„é­”é“¾ï¼‰</li>
                        <li><span class="emoji">ğŸ </span> å¿«é€’å‘˜<strong>ç¡®è®¤èº«ä»½</strong>ï¼Œä½ æˆåŠŸæ”¶åˆ°å•†å“ï¼ˆç™»å½•æˆåŠŸï¼‰</li>
                    </ol>
                    <p><strong>é­”é“¾ç™»å½•çš„åŸç†å®Œå…¨ä¸€æ ·ï¼</strong></p>
                </div>
            </div>
            
            <!-- æ•´ä½“æµç¨‹å›¾ -->
            <div class="section">
                <h2><span class="emoji">ğŸ”„</span> å®Œæ•´äº¤äº’æµç¨‹</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        flowchart TD
                            A["ğŸ‘¤ ç”¨æˆ·è¾“å…¥é‚®ç®±"] --> B["ğŸš€ ç‚¹å‡»å‘é€é­”é“¾"]
                            B --> C["ğŸ“¡ è¯·æ±‚å‘é€åˆ° Supabase"]
                            C --> D["ğŸ” Supabase ç”Ÿæˆä¸€æ¬¡æ€§ä»¤ç‰Œ"]
                            D --> E["ğŸ“§ å‘é€é‚®ä»¶åˆ°ç”¨æˆ·é‚®ç®±"]
                            E --> F["ğŸ“± ç”¨æˆ·æ”¶åˆ°é‚®ä»¶"]
                            F --> G["ğŸ–±ï¸ ç‚¹å‡»é‚®ä»¶ä¸­çš„é­”é“¾"]
                            G --> H["ğŸŒ æµè§ˆå™¨è®¿é—®é­”é“¾åœ°å€"]
                            H --> I["âœ… Supabase éªŒè¯ä»¤ç‰Œ"]
                            I --> J["ğŸ‰ ç™»å½•æˆåŠŸï¼Œç”Ÿæˆä¼šè¯"]
                            
                            style A fill:#e1f5fe
                            style J fill:#e8f5e8
                            style D fill:#fff3e0
                            style I fill:#fff3e0
                    </div>
                </div>
            </div>
            
            <!-- å‘é€é­”é“¾é˜¶æ®µ -->
            <div class="section">
                <h2><span class="emoji">ğŸ“¤</span> ç¬¬ä¸€é˜¶æ®µï¼šå‘é€é­”é“¾ï¼ˆåƒå¯„å¿«é€’ï¼‰</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as ğŸ‘¤ ç”¨æˆ·
                            participant W as ğŸŒ ç½‘ç«™å‰ç«¯
                            participant S as ğŸ›¡ï¸ Supabaseåç«¯
                            participant E as ğŸ“§ é‚®ä»¶æœåŠ¡
                            
                            U->>W: 1. è¾“å…¥é‚®ç®±åœ°å€
                            W->>S: 2. è°ƒç”¨ signInWithOtp()
                            Note over S: 3. ç”Ÿæˆä¸€æ¬¡æ€§ä»¤ç‰Œ<br/>Token: abc123xyz<br/>æœ‰æ•ˆæœŸ: 1å°æ—¶
                            S->>E: 4. å‘é€é‚®ä»¶æ¨¡æ¿
                            E->>U: 5. é‚®ä»¶é€è¾¾ç”¨æˆ·é‚®ç®±
                            S->>W: 6. è¿”å›"é‚®ä»¶å·²å‘é€"
                            W->>U: 7. æ˜¾ç¤º"è¯·æŸ¥æ”¶é‚®ç®±"
                    </div>
                </div>
                
                <div class="code-block">
// ğŸš€ ç”¨æˆ·ç‚¹å‡»"å‘é€é­”é“¾"æ—¶å‘ç”Ÿçš„äº‹æƒ…
const handleLogin = async () => {
  // 1. è°ƒç”¨Supabase API
  const { error } = await supabase.auth.signInWithOtp({ 
    email: 'user@example.com',
    options: {
      // 2. æŒ‡å®šç™»å½•æˆåŠŸåè·³è½¬çš„åœ°å€
      emailRedirectTo: 'https://oursite.com/profile'
    }
  })
  
  // 3. ç­‰å¾…Supabaseå¤„ç†ç»“æœ
  if (!error) {
    console.log('ğŸ“§ é­”é“¾å·²å‘é€ï¼')
  }
}
                </div>
                
                <div class="success-box">
                    <h4><span class="emoji">ğŸ”</span> èƒŒåå‘ç”Ÿçš„äº‹æƒ…ï¼š</h4>
                    <ol>
                        <li><strong>Supabaseç”Ÿæˆä»¤ç‰Œ</strong>ï¼š<code>abc123xyz789</code></li>
                        <li><strong>åˆ›å»ºé­”é“¾URL</strong>ï¼š<code>https://supabase.co/auth/v1/verify?token=abc123xyz789&redirect_to=https://oursite.com/profile</code></li>
                        <li><strong>å‘é€é‚®ä»¶</strong>ï¼šåŒ…å«è¿™ä¸ªé“¾æ¥çš„é‚®ä»¶å‘é€åˆ°ç”¨æˆ·é‚®ç®±</li>
                    </ol>
                </div>
            </div>
            
            <!-- éªŒè¯é­”é“¾é˜¶æ®µ -->
            <div class="section">
                <h2><span class="emoji">âœ…</span> ç¬¬äºŒé˜¶æ®µï¼šéªŒè¯é­”é“¾ï¼ˆåƒéªŒæ”¶å¿«é€’ï¼‰</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as ğŸ‘¤ ç”¨æˆ·
                            participant B as ğŸŒ æµè§ˆå™¨
                            participant S as ğŸ›¡ï¸ Supabaseåç«¯
                            participant W as ğŸ  æˆ‘ä»¬çš„ç½‘ç«™
                            
                            U->>B: 1. ç‚¹å‡»é‚®ä»¶ä¸­çš„é­”é“¾
                            Note over B: 2. é­”é“¾æ ¼å¼ï¼š<br/>https://supabase.co/auth/v1/verify<br/>?token=abc123xyz<br/>&type=magiclink<br/>&redirect_to=oursite.com/profile
                            B->>S: 3. è®¿é—®é­”é“¾åœ°å€
                            Note over S: 4. éªŒè¯ä»¤ç‰Œï¼š<br/>- æ£€æŸ¥tokenæ˜¯å¦å­˜åœ¨<br/>- æ£€æŸ¥æ˜¯å¦è¿‡æœŸ<br/>- æ£€æŸ¥æ˜¯å¦å·²ä½¿ç”¨
                            alt ä»¤ç‰Œæœ‰æ•ˆ
                                S->>S: 5. åˆ›å»ºç”¨æˆ·ä¼šè¯
                                Note over S: 6. ç”Ÿæˆ JWT Token<br/>åŒ…å«ç”¨æˆ·ä¿¡æ¯
                                S->>B: 7. é‡å®šå‘åˆ°æˆ‘ä»¬ç½‘ç«™
                                B->>W: 8. å¸¦ç€ä¼šè¯ä¿¡æ¯è®¿é—®
                                W->>U: 9. æ˜¾ç¤º"ç™»å½•æˆåŠŸ"
                            else ä»¤ç‰Œæ— æ•ˆ
                                S->>B: é‡å®šå‘åˆ°é”™è¯¯é¡µé¢
                                B->>U: æ˜¾ç¤º"ç™»å½•å¤±è´¥"
                            end
                    </div>
                </div>
            </div>
            
            <!-- æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µ -->
            <div class="section">
                <h2><span class="emoji">ğŸ”</span> æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µè§£é‡Š</h2>
                
                <h3><span class="emoji">1ï¸âƒ£</span> ä¸€æ¬¡æ€§ä»¤ç‰Œï¼ˆTokenï¼‰- åƒå¿«é€’å•å·</h3>
                <div class="code-block">
ğŸ« ä»¤ç‰Œå°±åƒå¿«é€’å•å·ï¼š
- æ¯ä¸ªä»¤ç‰Œéƒ½æ˜¯å”¯ä¸€çš„ï¼šabc123xyz
- åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ˆç”¨å®Œå°±ä½œåºŸï¼‰
- æœ‰æ—¶é—´é™åˆ¶ï¼ˆé€šå¸¸1å°æ—¶è¿‡æœŸï¼‰
- åŒ…å«ç”¨æˆ·é‚®ç®±ä¿¡æ¯
                </div>
                
                <h3><span class="emoji">2ï¸âƒ£</span> JWTä¼šè¯ä»¤ç‰Œ - åƒèº«ä»½è¯</h3>
                <div class="code-block">
ğŸ†” JWTä»¤ç‰Œå°±åƒä¸´æ—¶èº«ä»½è¯ï¼š
- åŒ…å«ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆé‚®ç®±ã€IDç­‰ï¼‰
- æœ‰è¿‡æœŸæ—¶é—´ï¼ˆé€šå¸¸1å°æ—¶ï¼‰
- å¯ä»¥è¢«ç½‘ç«™éªŒè¯çœŸä¼ª
- å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦
                </div>
                
                <h3><span class="emoji">3ï¸âƒ£</span> ç³»ç»Ÿæ¶æ„å›¾</h3>
                <div class="chart-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "ğŸ  ç”¨æˆ·è®¾å¤‡"
                                A[ğŸ“± æ‰‹æœº/ç”µè„‘æµè§ˆå™¨]
                                B[ğŸ“§ é‚®ç®±APP]
                            end
                            
                            subgraph "ğŸŒ æˆ‘ä»¬çš„ç½‘ç«™"
                                C[ğŸ“„ ç™»å½•é¡µé¢]
                                D[ğŸ‘¤ ä¸ªäººä¸­å¿ƒé¡µé¢]
                                E[ğŸ”§ Supabaseå®¢æˆ·ç«¯]
                            end
                            
                            subgraph "â˜ï¸ Supabaseäº‘æœåŠ¡"
                                F[ğŸ›¡ï¸ èº«ä»½è®¤è¯æœåŠ¡]
                                G[ğŸ“Š ç”¨æˆ·æ•°æ®åº“]
                                H[ğŸ“§ é‚®ä»¶å‘é€æœåŠ¡]
                            end
                            
                            subgraph "ğŸ“® ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡"
                                I[ğŸ“¨ é‚®ä»¶æœåŠ¡å•†<br/>å¦‚Gmail/QQé‚®ç®±]
                            end
                            
                            A -->|1. è¾“å…¥é‚®ç®±| C
                            C -->|2. å‘é€é­”é“¾è¯·æ±‚| E
                            E -->|3. è°ƒç”¨API| F
                            F -->|4. å­˜å‚¨ä»¤ç‰Œ| G
                            F -->|5. å‘é€é‚®ä»¶| H
                            H -->|6. æŠ•é€’é‚®ä»¶| I
                            I -->|7. æ¨é€é€šçŸ¥| B
                            B -->|8. ç‚¹å‡»é­”é“¾| A
                            A -->|9. è®¿é—®é­”é“¾| F
                            F -->|10. éªŒè¯æˆåŠŸ| G
                            F -->|11. é‡å®šå‘| D
                            
                            style F fill:#ffeb3b
                            style G fill:#4caf50
                            style A fill:#2196f3
                            style D fill:#e8f5e8
                    </div>
                </div>
            </div>
            
            <!-- å®‰å…¨åŸç† -->
            <div class="section">
                <h2><span class="emoji">ğŸ›¡ï¸</span> å®‰å…¨åŸç†ï¼šä¸ºä»€ä¹ˆé­”é“¾æ¯”å¯†ç æ›´å®‰å…¨ï¼Ÿ</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "ğŸ˜° ä¼ ç»Ÿå¯†ç ç™»å½•çš„é£é™©"
                                A[ğŸ¤” ç”¨æˆ·å¿˜è®°å¯†ç ] 
                                B[ğŸ˜± å¯†ç è¢«ç›—å–]
                                C[ğŸ”„ é‡å¤ä½¿ç”¨å¼±å¯†ç ]
                                D[ğŸ“ å¯†ç æ˜æ–‡å­˜å‚¨é£é™©]
                            end
                            
                            subgraph "âœ… é­”é“¾ç™»å½•çš„ä¼˜åŠ¿"
                                E[ğŸš« æ— éœ€è®°ä½å¯†ç ]
                                F[â° ä»¤ç‰Œè‡ªåŠ¨è¿‡æœŸ]
                                G[ğŸ¯ ä¸€æ¬¡æ€§ä½¿ç”¨]
                                H[ğŸ” é‚®ç®±äºŒæ¬¡éªŒè¯]
                            end
                            
                            A -.->|è§£å†³| E
                            B -.->|è§£å†³| F
                            C -.->|è§£å†³| G
                            D -.->|è§£å†³| H
                            
                            style A fill:#ffcdd2
                            style B fill:#ffcdd2
                            style C fill:#ffcdd2
                            style D fill:#ffcdd2
                            style E fill:#c8e6c9
                            style F fill:#c8e6c9
                            style G fill:#c8e6c9
                            style H fill:#c8e6c9
                    </div>
                </div>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>å®‰å…¨ç‰¹æ€§</th>
                            <th>å·¥ä½œåŸç†</th>
                            <th>å¥½å¤„</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="emoji">â°</span> <strong>æ—¶é—´é™åˆ¶</strong></td>
                            <td>ä»¤ç‰Œ1å°æ—¶åè‡ªåŠ¨è¿‡æœŸ</td>
                            <td>é˜²æ­¢é•¿æœŸè¢«æ¶æ„ä½¿ç”¨</td>
                        </tr>
                        <tr>
                            <td><span class="emoji">ğŸ¯</span> <strong>ä¸€æ¬¡æ€§ä½¿ç”¨</strong></td>
                            <td>ä»¤ç‰Œä½¿ç”¨åç«‹å³å¤±æ•ˆ</td>
                            <td>é˜²æ­¢é‡æ”¾æ”»å‡»</td>
                        </tr>
                        <tr>
                            <td><span class="emoji">ğŸ“§</span> <strong>é‚®ç®±éªŒè¯</strong></td>
                            <td>å¿…é¡»æ§åˆ¶é‚®ç®±æ‰èƒ½ç™»å½•</td>
                            <td>ç¡®ä¿ç”¨æˆ·èº«ä»½çœŸå®æ€§</td>
                        </tr>
                        <tr>
                            <td><span class="emoji">ğŸ”</span> <strong>åŠ å¯†ä¼ è¾“</strong></td>
                            <td>æ‰€æœ‰é€šä¿¡ä½¿ç”¨HTTPS</td>
                            <td>é˜²æ­¢ä¸­é—´äººæ”»å‡»</td>
                        </tr>
                        <tr>
                            <td><span class="emoji">ğŸ“</span> <strong>é‡å®šå‘é™åˆ¶</strong></td>
                            <td>åªèƒ½é‡å®šå‘åˆ°é¢„è®¾åœ°å€</td>
                            <td>é˜²æ­¢é’“é±¼æ”»å‡»</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- çŠ¶æ€ç®¡ç† -->
            <div class="section">
                <h2><span class="emoji">ğŸ”„</span> çŠ¶æ€ç®¡ç†ï¼šç™»å½•åå¦‚ä½•ä¿æŒçŠ¶æ€ï¼Ÿ</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TD
                            A[ğŸ‘¤ ç”¨æˆ·ç‚¹å‡»é­”é“¾] --> B[ğŸŒ æµè§ˆå™¨è®¿é—®Supabase]
                            B --> C{ğŸ” SupabaseéªŒè¯ä»¤ç‰Œ}
                            
                            C -->|âœ… æœ‰æ•ˆ| D[ğŸ” ç”ŸæˆJWTä¼šè¯ä»¤ç‰Œ]
                            C -->|âŒ æ— æ•ˆ| E[ğŸš« æ‹’ç»ç™»å½•]
                            
                            D --> F[ğŸ“ é‡å®šå‘åˆ°æˆ‘ä»¬ç½‘ç«™]
                            F --> G[ğŸ’¾ æµè§ˆå™¨å­˜å‚¨JWTä»¤ç‰Œ]
                            
                            G --> H[ğŸ“„ åŠ è½½ä¸ªäººä¸­å¿ƒé¡µé¢]
                            H --> I[ğŸ” æ£€æŸ¥æœ¬åœ°JWTä»¤ç‰Œ]
                            I --> J[âœ… æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯]
                            
                            subgraph "ğŸ§  æµè§ˆå™¨å­˜å‚¨"
                                K[ğŸª Cookies]
                                L[ğŸ’¾ LocalStorage]
                                M[ğŸ“¦ SessionStorage]
                            end
                            
                            G -.-> K
                            G -.-> L
                            G -.-> M
                            
                            style D fill:#4caf50
                            style E fill:#f44336
                            style J fill:#e8f5e8
                    </div>
                </div>
                
                <div class="code-block">
// ğŸ” æˆ‘ä»¬çš„ç½‘ç«™å¦‚ä½•æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
useEffect(() => {
  // 1. è·å–å½“å‰ä¼šè¯ä¿¡æ¯
  supabase.auth.getSession().then(({ data: { session } }) => {
    if (session) {
      console.log('âœ… ç”¨æˆ·å·²ç™»å½•:', session.user.email)
      setUser(session.user)
    } else {
      console.log('âŒ ç”¨æˆ·æœªç™»å½•')
      setUser(null)
    }
  })

  // 2. ç›‘å¬ç™»å½•çŠ¶æ€å˜åŒ–
  const { data: { subscription } } = supabase.auth.onAuthStateChange(
    (event, session) => {
      console.log('ğŸ”„ ç™»å½•çŠ¶æ€å˜åŒ–:', event)
      if (event === 'SIGNED_IN') {
        console.log('ğŸ‰ ç”¨æˆ·åˆšåˆšç™»å½•')
      } else if (event === 'SIGNED_OUT') {
        console.log('ğŸ‘‹ ç”¨æˆ·åˆšåˆšç™»å‡º')
      }
    }
  )

  return () => subscription.unsubscribe()
}, [])
                </div>
            </div>
            
            <!-- å¸¸è§é—®é¢˜ -->
            <div class="section">
                <h2><span class="emoji">ğŸ¤”</span> å¸¸è§é—®é¢˜è§£ç­”</h2>
                
                <h3><span class="emoji">â“</span> ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ”¶ä¸åˆ°é­”é“¾é‚®ä»¶ï¼Ÿ</h3>
                
                <div class="chart-container">
                    <div class="mermaid">
                        flowchart TD
                            A[ğŸ“§ é­”é“¾é‚®ä»¶å‘é€] --> B{ğŸ“® é‚®ä»¶æŠ•é€’çŠ¶æ€}
                            
                            B -->|âœ… æˆåŠŸæŠ•é€’| C[ğŸ“± ç”¨æˆ·é‚®ç®±]
                            B -->|âš ï¸ è¢«æ‹¦æˆª| D[ğŸ—‚ï¸ åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹]
                            B -->|âŒ æŠ•é€’å¤±è´¥| E[ğŸš« é‚®ä»¶æœåŠ¡å™¨æ‹’ç»]
                            
                            C --> F[ğŸ‰ ç”¨æˆ·æ­£å¸¸æ”¶åˆ°]
                            D --> G[ğŸ” éœ€è¦æ£€æŸ¥åƒåœ¾é‚®ä»¶]
                            E --> H[âŒ éœ€è¦é‡æ–°å‘é€]
                            
                            subgraph "ğŸ›¡ï¸ å¯èƒ½çš„æ‹¦æˆªåŸå› "
                                I[ğŸ“Š å‘é€é¢‘ç‡è¿‡é«˜]
                                J[ğŸ·ï¸ é‚®ä»¶æ ‡é¢˜æ•æ„Ÿ]
                                K[ğŸŒ åŸŸåä¿¡èª‰åº¦ä½]
                                L[ğŸ“§ æ”¶ä»¶äººé‚®ç®±è®¾ç½®]
                            end
                            
                            D -.-> I
                            D -.-> J
                            D -.-> K
                            D -.-> L
                            
                            style F fill:#c8e6c9
                            style G fill:#fff3e0
                            style H fill:#ffcdd2
                    </div>
                </div>
            </div>
            
            <!-- å¯¹æ¯”å…¶ä»–ç™»å½•æ–¹å¼ -->
            <div class="section">
                <h2><span class="emoji">ğŸ’¡</span> å¯¹æ¯”å…¶ä»–ç™»å½•æ–¹å¼</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "ğŸ”‘ ä¼ ç»Ÿå¯†ç ç™»å½•"
                                A[è¾“å…¥ç”¨æˆ·å] --> B[è¾“å…¥å¯†ç ] 
                                B --> C[æœåŠ¡å™¨éªŒè¯]
                                C --> D{å¯†ç æ­£ç¡®?}
                                D -->|æ˜¯| E[ç™»å½•æˆåŠŸ]
                                D -->|å¦| F[ç™»å½•å¤±è´¥]
                            end
                            
                            subgraph "ğŸ“± çŸ­ä¿¡éªŒè¯ç "
                                G[è¾“å…¥æ‰‹æœºå·] --> H[å‘é€çŸ­ä¿¡]
                                H --> I[è¾“å…¥éªŒè¯ç ]
                                I --> J{éªŒè¯ç æ­£ç¡®?}
                                J -->|æ˜¯| K[ç™»å½•æˆåŠŸ]
                                J -->|å¦| L[ç™»å½•å¤±è´¥]
                            end
                            
                            subgraph "âœ¨ é‚®ç®±é­”é“¾"
                                M[è¾“å…¥é‚®ç®±] --> N[å‘é€é­”é“¾]
                                N --> O[ç‚¹å‡»é‚®ä»¶é“¾æ¥]
                                O --> P[è‡ªåŠ¨éªŒè¯]
                                P --> Q[ç™»å½•æˆåŠŸ]
                            end
                            
                            style E fill:#c8e6c9
                            style F fill:#ffcdd2
                            style K fill:#c8e6c9
                            style L fill:#ffcdd2
                            style Q fill:#c8e6c9
                    </div>
                </div>
            </div>
            
            <!-- ä¹æ­¥æµç¨‹æ€»ç»“ -->
            <div class="section">
                <h2><span class="emoji">ğŸ“‹</span> ä¹æ­¥é­”é“¾ç™»å½•å®Œæ•´æµç¨‹</h2>
                
                <div class="step-list">
                    <ol>
                        <li><span class="emoji">1ï¸âƒ£</span> ç”¨æˆ·è¾“å…¥é‚®ç®± â†’ <code>user@example.com</code></li>
                        <li><span class="emoji">2ï¸âƒ£</span> ç½‘ç«™è°ƒç”¨API â†’ <code>supabase.auth.signInWithOtp()</code></li>
                        <li><span class="emoji">3ï¸âƒ£</span> Supabaseç”Ÿæˆä»¤ç‰Œ â†’ <code>token: abc123xyz (1å°æ—¶æœ‰æ•ˆ)</code></li>
                        <li><span class="emoji">4ï¸âƒ£</span> å‘é€é‚®ä»¶ â†’ åŒ…å«é­”é“¾çš„é‚®ä»¶æŠ•é€’åˆ°ç”¨æˆ·é‚®ç®±</li>
                        <li><span class="emoji">5ï¸âƒ£</span> ç”¨æˆ·æ”¶åˆ°é‚®ä»¶ â†’ é‚®ç®±APPæ˜¾ç¤ºæ–°é‚®ä»¶é€šçŸ¥</li>
                        <li><span class="emoji">6ï¸âƒ£</span> ç‚¹å‡»é­”é“¾ â†’ æµè§ˆå™¨è®¿é—® Supabase éªŒè¯åœ°å€</li>
                        <li><span class="emoji">7ï¸âƒ£</span> SupabaseéªŒè¯ â†’ æ£€æŸ¥ä»¤ç‰Œæœ‰æ•ˆæ€§å’Œè¿‡æœŸæ—¶é—´</li>
                        <li><span class="emoji">8ï¸âƒ£</span> åˆ›å»ºä¼šè¯ â†’ ç”ŸæˆJWTä»¤ç‰Œï¼Œå­˜å‚¨åˆ°æµè§ˆå™¨</li>
                        <li><span class="emoji">9ï¸âƒ£</span> é‡å®šå‘æˆåŠŸ â†’ ç”¨æˆ·ç™»å½•å®Œæˆï¼Œè·³è½¬åˆ°ä¸ªäººä¸­å¿ƒ</li>
                    </ol>
                </div>
            </div>
            
            <!-- JWTä»¤ç‰Œè¯¦è§£ -->
            <div class="section">
                <h2><span class="emoji">ğŸ“</span> JWTä»¤ç‰Œçš„å®é™…å†…å®¹</h2>
                
                <div class="code-block">
// ğŸ« JWTä»¤ç‰Œå®é™…ä¸ŠåŒ…å«ä¸‰éƒ¨åˆ†ï¼Œç”¨ç‚¹å·åˆ†éš”ï¼š
// Header.Payload.Signature

// ğŸ“‹ Headerï¼ˆå¤´éƒ¨ï¼‰- ä»¤ç‰Œç±»å‹å’ŒåŠ å¯†ç®—æ³•
{
  "alg": "HS256",  // åŠ å¯†ç®—æ³•
  "typ": "JWT"     // ä»¤ç‰Œç±»å‹
}

// ğŸ“¦ Payloadï¼ˆè½½è·ï¼‰- ç”¨æˆ·ä¿¡æ¯å’Œè¿‡æœŸæ—¶é—´  
{
  "sub": "user-uuid-123",           // ç”¨æˆ·ID
  "email": "user@example.com",      // é‚®ç®±
  "iat": 1641024000,               // ç­¾å‘æ—¶é—´
  "exp": 1641027600,               // è¿‡æœŸæ—¶é—´
  "role": "authenticated"          // ç”¨æˆ·è§’è‰²
}

// ğŸ” Signatureï¼ˆç­¾åï¼‰- é˜²ç¯¡æ”¹éªŒè¯
// ä½¿ç”¨å¯†é’¥å¯¹Headerå’ŒPayloadè¿›è¡Œç­¾å
                </div>
            </div>
            
            <!-- é­”é“¾é‚®ä»¶å†…å®¹ -->
            <div class="section">
                <h2><span class="emoji">ğŸ“§</span> é­”é“¾é‚®ä»¶çš„å®é™…å†…å®¹</h2>
                
                <div class="code-block">
&lt;!-- ğŸ“¨ ç”¨æˆ·æ”¶åˆ°çš„é‚®ä»¶å¤§æ¦‚é•¿è¿™æ · --&gt;
&lt;div style="text-align: center;"&gt;
  &lt;h2&gt;ğŸ” ç™»å½•ç¡®è®¤&lt;/h2&gt;
  &lt;p&gt;ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å®Œæˆç™»å½•ï¼š&lt;/p&gt;
  
  &lt;!-- ğŸ¯ è¿™å°±æ˜¯ç¥å¥‡çš„é­”é“¾ï¼ --&gt;
  &lt;a href="https://pdlvxfddebmriqiyyuaf.supabase.co/auth/v1/verify?token=abc123xyz&type=magiclink&redirect_to=https://oursite.com/Day12/profile"
     style="background: blue; color: white; padding: 10px;"&gt;
    âœ¨ ç‚¹å‡»ç™»å½•
  &lt;/a&gt;
  
  &lt;p&gt;&lt;small&gt;â° é“¾æ¥å°†åœ¨1å°æ—¶åè¿‡æœŸ&lt;/small&gt;&lt;/p&gt;
&lt;/div&gt;
                </div>
            </div>
            
            <!-- æ€»ç»“ -->
            <div class="section">
                <h2><span class="emoji">ğŸ‰</span> æ€»ç»“ï¼šé­”é“¾ç™»å½•çš„æ ¸å¿ƒä¼˜åŠ¿</h2>
                
                <div class="success-box">
                    <h4><span class="emoji">âœ¨</span> ä¸ºä»€ä¹ˆé­”é“¾ç™»å½•è¿™ä¹ˆå—æ¬¢è¿ï¼Ÿ</h4>
                    
                    <h4><span class="emoji">ğŸš€</span> ç”¨æˆ·ä½“éªŒæä½³</h4>
                    <ul>
                        <li>æ— éœ€è®°ä½å¤æ‚å¯†ç </li>
                        <li>ä¸€é”®ç™»å½•ï¼Œæµç¨‹ç®€å•</li>
                        <li>å‡å°‘ç”¨æˆ·æµå¤±</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ›¡ï¸</span> å®‰å…¨æ€§æ›´é«˜</h4>
                    <ul>
                        <li>åŸºäºé‚®ç®±çš„åŒé‡éªŒè¯</li>
                        <li>ä»¤ç‰Œè‡ªåŠ¨è¿‡æœŸï¼Œæ— æ³•é‡å¤ä½¿ç”¨</li>
                        <li>å‡å°‘å¯†ç æ³„éœ²é£é™©</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ”§</span> å¼€å‘ç®€å•</h4>
                    <ul>
                        <li>Supabaseæä¾›å®Œæ•´è§£å†³æ–¹æ¡ˆ</li>
                        <li>æ— éœ€è‡ªå»ºé‚®ä»¶æœåŠ¡</li>
                        <li>å‡ è¡Œä»£ç å³å¯å®ç°</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ’°</span> æˆæœ¬æ›´ä½</h4>
                    <ul>
                        <li>å‡å°‘å®¢æœæˆæœ¬ï¼ˆæ— å¯†ç é‡ç½®éœ€æ±‚ï¼‰</li>
                        <li>æé«˜è½¬åŒ–ç‡</li>
                        <li>é™ä½å®‰å…¨é£é™©æˆæœ¬</li>
                    </ul>
                </div>
                
                <div class="warning-box">
                    <h4><span class="emoji">ğŸ¯</span> é€‚ç”¨åœºæ™¯</h4>
                    
                    <p><strong><span class="emoji">âœ…</span> é€‚åˆä½¿ç”¨é­”é“¾ç™»å½•çš„åœºæ™¯ï¼š</strong></p>
                    <ul>
                        <li>å†…å®¹å¹³å°ã€åšå®¢ç½‘ç«™</li>
                        <li>ç”µå•†ç½‘ç«™çš„å¿«é€Ÿç™»å½•</li>
                        <li>SaaSåº”ç”¨çš„è¯•ç”¨æ³¨å†Œ</li>
                        <li>ç§»åŠ¨ç«¯APPè¾…åŠ©ç™»å½•</li>
                    </ul>
                    
                    <p><strong><span class="emoji">âŒ</span> ä¸å¤ªé€‚åˆçš„åœºæ™¯ï¼š</strong></p>
                    <ul>
                        <li>é«˜é¢‘è®¿é—®çš„åº”ç”¨ï¼ˆå¦‚èŠå¤©è½¯ä»¶ï¼‰</li>
                        <li>éœ€è¦ç¦»çº¿è®¿é—®çš„åº”ç”¨</li>
                        <li>å¯¹é‚®ä»¶ä¾èµ–åº¦é«˜çš„ä¼ä¸šç¯å¢ƒ</li>
                    </ul>
                </div>
            </div>
            
            <!-- é¡µè„š -->
            <div class="section">
                <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 8px; margin-top: 40px;">
                    <p><strong><span class="emoji">ğŸ“</span> æ–‡æ¡£ç‰ˆæœ¬</strong>ï¼šDay12 - Supabase é­”é“¾ç™»å½•åŸç†è¯¦è§£</p>
                    <p><strong><span class="emoji">ğŸ“…</span> åˆ›å»ºæ—¥æœŸ</strong>ï¼š2025å¹´1æœˆ</p>
                    <p><strong><span class="emoji">ğŸš€</span> é¡¹ç›®</strong>ï¼šNext.js 30å¤©å­¦ä¹ ä¹‹æ—…</p>
                    <p style="margin-top: 15px; color: #666;">
                        å¸Œæœ›è¿™ä¸ªè¯¦ç»†çš„è§£æå¸®åŠ©æ‚¨å®Œå…¨ç†è§£äº†Supabaseé­”é“¾ç™»å½•çš„å·¥ä½œåŸç†ï¼<span class="emoji">ğŸ‰</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ– Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
        
        // æ·»åŠ ç‚¹å‡»å›¾è¡¨å¤åˆ¶åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const charts = document.querySelectorAll('.mermaid');
            charts.forEach(chart => {
                chart.style.cursor = 'pointer';
                chart.title = 'ç‚¹å‡»å¤åˆ¶å›¾è¡¨æºç ';
                chart.addEventListener('click', function() {
                    const text = this.textContent.trim();
                    navigator.clipboard.writeText(text).then(() => {
                        const originalTitle = this.title;
                        this.title = 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼';
                        setTimeout(() => {
                            this.title = originalTitle;
                        }, 2000);
                    });
                });
            });
            
            // æ·»åŠ ä»£ç å—å¤åˆ¶åŠŸèƒ½
            const codeBlocks = document.querySelectorAll('.code-block');
            codeBlocks.forEach(block => {
                block.style.cursor = 'pointer';
                block.title = 'ç‚¹å‡»å¤åˆ¶ä»£ç ';
                block.addEventListener('click', function() {
                    const text = this.textContent.trim();
                    navigator.clipboard.writeText(text).then(() => {
                        const originalBg = this.style.backgroundColor;
                        this.style.backgroundColor = '#2f855a';
                        setTimeout(() => {
                            this.style.backgroundColor = originalBg;
                        }, 1000);
                    });
                });
            });
        });
        
        // æ·»åŠ å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html> 