<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day13 Supabase å®æ—¶Todoåº”ç”¨åŸç†è¯¦è§£</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 50%, #8b5cf6 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section h2 {
            font-size: 1.8rem;
            color: #2d3748;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
            padding-left: 15px;
        }
        
        .section h3 {
            font-size: 1.4rem;
            color: #4a5568;
            margin: 30px 0 15px 0;
        }
        
        .analogy-box {
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .analogy-box h4 {
            color: #047857;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .chart-container {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .file-structure {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .file-item {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        
        .file-item.folder {
            background: #dbeafe;
            font-weight: bold;
        }
        
        .file-item.file {
            background: #f0f9ff;
            margin-left: 20px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            background: #3b82f6;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8fafc;
        }
        
        .highlight-box {
            background: #fef2f2;
            border: 2px solid #f87171;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success-box {
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning-box {
            background: #fefce8;
            border: 2px solid #eab308;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .info-box {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .step-list {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .step-list ol {
            padding-left: 20px;
        }
        
        .step-list li {
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .emoji {
            font-size: 1.2em;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
        }
        
        /* Mermaid diagram styling */
        .mermaid {
            text-align: center;
            margin: 20px 0;
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .header {
                background: #3b82f6 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="emoji">ğŸ“</span> Day13 Supabase å®æ—¶Todoåº”ç”¨åŸç†è¯¦è§£</h1>
            <p>ä»é›¶ç†è§£ç°ä»£å…¨æ ˆå®æ—¶åº”ç”¨çš„å·¥ä½œæœºåˆ¶</p>
        </div>
        
        <div class="content">
            <!-- ç”Ÿæ´»ç±»æ¯” -->
            <div class="section">
                <h2><span class="emoji">ğŸ¢</span> ç”Ÿæ´»ç±»æ¯”ï¼šå®æ—¶Todoå°±åƒåŠå…¬å®¤åä½œç™½æ¿</h2>
                
                <div class="analogy-box">
                    <h4><span class="emoji">ğŸ“‹</span> æƒ³è±¡ä¸€ä¸ªæ™ºèƒ½åŠå…¬å®¤ç™½æ¿ç³»ç»Ÿï¼š</h4>
                    <ol>
                        <li><span class="emoji">ğŸ‘¥</span> <strong>å¤šäººåä½œ</strong>ï¼šå›¢é˜Ÿæˆå‘˜å¯ä»¥åŒæ—¶åœ¨ç™½æ¿ä¸Šå†™ä»»åŠ¡</li>
                        <li><span class="emoji">ğŸ”„</span> <strong>å®æ—¶åŒæ­¥</strong>ï¼šä¸€ä¸ªäººå†™çš„å†…å®¹ï¼Œå…¶ä»–äººç«‹å³çœ‹åˆ°</li>
                        <li><span class="emoji">âœ…</span> <strong>çŠ¶æ€æ›´æ–°</strong>ï¼šå®Œæˆä»»åŠ¡æ—¶ï¼Œæ‰€æœ‰äººçš„ç™½æ¿éƒ½ä¼šæ›´æ–°</li>
                        <li><span class="emoji">ğŸ—‘ï¸</span> <strong>åˆ é™¤ä»»åŠ¡</strong>ï¼šåˆ é™¤çš„ä»»åŠ¡åœ¨æ‰€æœ‰ç™½æ¿ä¸ŠåŒæ—¶æ¶ˆå¤±</li>
                        <li><span class="emoji">ğŸ›¡ï¸</span> <strong>å®‰å…¨ç®¡ç†</strong>ï¼šåªæœ‰æˆæƒäººå‘˜æ‰èƒ½ä¿®æ”¹é‡è¦ä»»åŠ¡</li>
                    </ol>
                    <p><strong>æˆ‘ä»¬çš„Todoåº”ç”¨å°±æ˜¯è¿™æ ·ä¸€ä¸ªæ•°å­—åŒ–çš„æ™ºèƒ½ç™½æ¿ï¼</strong></p>
                </div>
            </div>
            
            <!-- é¡¹ç›®æ–‡ä»¶ç»“æ„ -->
            <div class="section">
                <h2><span class="emoji">ğŸ“</span> é¡¹ç›®æ–‡ä»¶ç»“æ„ä¸åŠŸèƒ½è¯´æ˜</h2>
                
                <div class="file-structure">
<div class="file-item folder">ğŸ“ src/app/Day13/</div>
<div class="file-item file">ğŸ“„ page.tsx - ä¸»é¡µé¢ç»„ä»¶ï¼ˆæ•´åˆæ‰€æœ‰åŠŸèƒ½ï¼‰</div>
<div class="file-item file">âš¡ action.ts - Server Actionsï¼ˆæœåŠ¡ç«¯æ•°æ®æ“ä½œï¼‰</div>
<div class="file-item file">ğŸ—ƒï¸ supabase-setup.sql - æ•°æ®åº“å»ºè¡¨è„šæœ¬</div>
<div class="file-item file">ğŸ“– README.md - é¡¹ç›®è¯´æ˜æ–‡æ¡£</div>
<div class="file-item folder">ğŸ“ components/</div>
<div class="file-item file">ğŸ“ TodoForm.tsx - ä»»åŠ¡åˆ›å»ºè¡¨å•ç»„ä»¶</div>
<div class="file-item file">ğŸ“‹ TodoList.tsx - ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤ºç»„ä»¶</div>
<div class="file-item folder">ğŸ“ lib/</div>
<div class="file-item file">ğŸ”— supabaseClient.ts - å®¢æˆ·ç«¯è¿æ¥é…ç½®</div>
                </div>
                
                <div class="info-box">
                    <h4><span class="emoji">ğŸ—ï¸</span> æ¶æ„è®¾è®¡åŸåˆ™ï¼š</h4>
                    <ul>
                        <li><strong>ç»„ä»¶åŒ–</strong>ï¼šæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹å°è£…</li>
                        <li><strong>èŒè´£åˆ†ç¦»</strong>ï¼šè¡¨å•ã€åˆ—è¡¨ã€æ•°æ®æ“ä½œå„å¸å…¶èŒ</li>
                        <li><strong>åŒå®¢æˆ·ç«¯</strong>ï¼šå®¢æˆ·ç«¯ï¼ˆæŸ¥è¯¢ï¼‰+ æœåŠ¡ç«¯ï¼ˆæ“ä½œï¼‰</li>
                        <li><strong>å®æ—¶åŒæ­¥</strong>ï¼šWebSocketè‡ªåŠ¨æ›´æ–°</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ•´ä½“ç³»ç»Ÿæ¶æ„ -->
            <div class="section">
                <h2><span class="emoji">ğŸ—ï¸</span> ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "ğŸ–¥ï¸ ç”¨æˆ·ç•Œé¢å±‚"
                                A[ğŸ“„ page.tsx<br/>ä¸»é¡µé¢]
                                B[ğŸ“ TodoForm.tsx<br/>ä»»åŠ¡åˆ›å»ºè¡¨å•]
                                C[ğŸ“‹ TodoList.tsx<br/>ä»»åŠ¡åˆ—è¡¨]
                            end
                            
                            subgraph "âš¡ ä¸šåŠ¡é€»è¾‘å±‚"
                                D[ğŸ”§ action.ts<br/>Server Actions]
                                E[ğŸ”— supabaseClient.ts<br/>å®¢æˆ·ç«¯è¿æ¥]
                            end
                            
                            subgraph "â˜ï¸ Supabaseäº‘æœåŠ¡"
                                F[ğŸ—„ï¸ PostgreSQLæ•°æ®åº“<br/>todosè¡¨]
                                G[ğŸ“¡ Realtime Engine<br/>WebSocketæœåŠ¡]
                                H[ğŸ›¡ï¸ Auth Service<br/>è®¤è¯æœåŠ¡]
                            end
                            
                            subgraph "ğŸ”‘ ç¯å¢ƒé…ç½®"
                                I[ğŸŒ NEXT_PUBLIC_SUPABASE_URL<br/>é¡¹ç›®åœ°å€]
                                J[ğŸ‘¥ NEXT_PUBLIC_SUPABASE_ANON_KEY<br/>å®¢æˆ·ç«¯å¯†é’¥]
                                K[ğŸ” SUPABASE_SERVICE_ROLE_KEY<br/>æœåŠ¡ç«¯å¯†é’¥]
                            end
                            
                            A --> B
                            A --> C
                            B --> D
                            C --> E
                            C --> G
                            D --> F
                            E --> F
                            E --> G
                            D -.-> K
                            E -.-> J
                            F -.-> I
                            
                            style F fill:#22c55e
                            style G fill:#f59e0b
                            style D fill:#3b82f6
                            style K fill:#ef4444
                    </div>
                </div>
            </div>
            
            <!-- å®Œæ•´æ•°æ®æµç¨‹ -->
            <div class="section">
                <h2><span class="emoji">ğŸ”„</span> å®Œæ•´æ•°æ®æµç¨‹å›¾</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as ğŸ‘¤ ç”¨æˆ·
                            participant F as ğŸ“ TodoForm
                            participant A as âš¡ Server Action
                            participant D as ğŸ—„ï¸ Database
                            participant R as ğŸ“¡ Realtime
                            participant L as ğŸ“‹ TodoList
                            
                            Note over U,L: ğŸ¯ åˆ›å»ºæ–°ä»»åŠ¡æµç¨‹
                            U->>F: 1. è¾“å…¥ä»»åŠ¡å†…å®¹
                            F->>A: 2. è°ƒç”¨ addTodo()
                            Note over A: 3. ä½¿ç”¨ SERVICE_ROLE_KEY<br/>è·³è¿‡RLSéªŒè¯
                            A->>D: 4. INSERTæ–°è®°å½•
                            D->>R: 5. è‡ªåŠ¨è§¦å‘ INSERT äº‹ä»¶
                            R->>L: 6. WebSocketæ¨é€æ›´æ–°
                            L->>L: 7. æ›´æ–°æœ¬åœ°çŠ¶æ€
                            A->>F: 8. è¿”å›æ“ä½œç»“æœ
                            F->>U: 9. æ¸…ç©ºè¡¨å•ï¼Œæ˜¾ç¤ºæˆåŠŸ
                            
                            Note over U,L: âœ… åˆ‡æ¢ä»»åŠ¡çŠ¶æ€æµç¨‹
                            U->>L: 10. ç‚¹å‡»ä»»åŠ¡å®ŒæˆæŒ‰é’®
                            L->>A: 11. è°ƒç”¨ toggleDone()
                            A->>D: 12. UPDATEè®°å½•çŠ¶æ€
                            D->>R: 13. è§¦å‘ UPDATE äº‹ä»¶
                            R->>L: 14. æ¨é€çŠ¶æ€å˜åŒ–
                            L->>L: 15. æ›´æ–°UIæ˜¾ç¤º
                            
                            Note over U,L: ğŸ—‘ï¸ åˆ é™¤ä»»åŠ¡æµç¨‹
                            U->>L: 16. ç‚¹å‡»åˆ é™¤æŒ‰é’®
                            L->>A: 17. è°ƒç”¨ removeTodo()
                            A->>D: 18. DELETEè®°å½•
                            D->>R: 19. è§¦å‘ DELETE äº‹ä»¶
                            R->>L: 20. æ¨é€åˆ é™¤é€šçŸ¥
                            L->>L: 21. ä»åˆ—è¡¨ç§»é™¤
                    </div>
                </div>
            </div>
            
            <!-- æ–‡ä»¶è¯¦è§£ï¼špage.tsx -->
            <div class="section">
                <h2><span class="emoji">ğŸ“„</span> æ–‡ä»¶è¯¦è§£ï¼špage.tsx - ä¸»é¡µé¢ç»„ä»¶</h2>
                
                <div class="code-block">
// ğŸ  ä¸»é¡µé¢ï¼šæ•´åˆæ‰€æœ‰åŠŸèƒ½çš„å®¹å™¨
import TodoForm from './components/TodoForm'
import TodoList from './components/TodoList'

export const dynamic = 'force-dynamic'   // ğŸ”„ å¼ºåˆ¶SSR+å®æ—¶

export default function Page() {
  return (
    &lt;main&gt;
      {/* ğŸ“ ä»»åŠ¡åˆ›å»ºåŒºåŸŸ */}
      &lt;TodoForm /&gt;
      
      {/* ğŸ“‹ ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ */}  
      &lt;TodoList /&gt;
    &lt;/main&gt;
  )
}
                </div>
                
                <div class="info-box">
                    <h4><span class="emoji">ğŸ¯</span> å…³é”®æŠ€æœ¯ç‚¹ï¼š</h4>
                    <ul>
                        <li><strong>`export const dynamic = 'force-dynamic'`</strong>ï¼šç¦ç”¨é™æ€ç”Ÿæˆï¼Œå¯ç”¨æœåŠ¡ç«¯æ¸²æŸ“</li>
                        <li><strong>ç»„ä»¶ç»„åˆ</strong>ï¼šå°†TodoFormå’ŒTodoListç»„åˆæˆå®Œæ•´åº”ç”¨</li>
                        <li><strong>ç®€æ´è®¾è®¡</strong>ï¼šé¡µé¢åªè´Ÿè´£å¸ƒå±€ï¼Œä¸å¤„ç†ä¸šåŠ¡é€»è¾‘</li>
                        <li><strong>å“åº”å¼å¸ƒå±€</strong>ï¼šä½¿ç”¨Tailwind CSSå®ç°ç¾è§‚ç•Œé¢</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ–‡ä»¶è¯¦è§£ï¼šaction.ts -->
            <div class="section">
                <h2><span class="emoji">âš¡</span> æ–‡ä»¶è¯¦è§£ï¼šaction.ts - Server Actions</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TD
                            A[ğŸ“± å®¢æˆ·ç«¯è°ƒç”¨] --> B{âš¡ Server Action}
                            B --> C[ğŸ” Service Role KeyéªŒè¯]
                            C --> D[ğŸ—„ï¸ æ•°æ®åº“æ“ä½œ]
                            D --> E[ğŸ“¡ Realtimeäº‹ä»¶è§¦å‘]
                            E --> F[ğŸ“¤ ç»“æœè¿”å›å®¢æˆ·ç«¯]
                            
                            subgraph "ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶"
                                G[ğŸš« è·³è¿‡RLSæ£€æŸ¥]
                                H[ğŸ”’ æœåŠ¡ç«¯æ‰§è¡Œ]
                                I[ğŸ›¡ï¸ æƒé™å®Œæ•´]
                            end
                            
                            C -.-> G
                            C -.-> H
                            C -.-> I
                            
                            style B fill:#3b82f6
                            style C fill:#ef4444
                            style E fill:#f59e0b
                    </div>
                </div>
                
                <div class="code-block">
'use server'  // ğŸš¨ é‡è¦ï¼šServer Actionæ ‡è¯†

// ğŸ” æœåŠ¡ç«¯å®¢æˆ·ç«¯ï¼šæ‹¥æœ‰å®Œæ•´æƒé™
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!  // âš¡ SERVICE_ROLE_KEY
)

// ğŸ“ æ–°å¢ä»»åŠ¡
export async function addTodo(content: string, userId: string) {
  const { data, error } = await supabase
    .from('todos')
    .insert({ content, user_id: userId, done: false })
    .select('*')
    .single()
    
  // ğŸ”„ æ•°æ®åº“è‡ªåŠ¨è§¦å‘Realtimeäº‹ä»¶ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯æ”¶åˆ°æ›´æ–°
  return { data, error }
}

// âœ… åˆ‡æ¢ä»»åŠ¡çŠ¶æ€
export async function toggleDone(id: number, done: boolean) {
  const { data, error } = await supabase
    .from('todos')
    .update({ done: !done })
    .eq('id', id)
    .select('*')
    .single()
    
  return { data, error }
}

// ğŸ—‘ï¸ åˆ é™¤ä»»åŠ¡
export async function removeTodo(id: number) {
  const { error } = await supabase
    .from('todos')
    .delete()
    .eq('id', id)
    
  return { error }
}
                </div>
                
                <div class="success-box">
                    <h4><span class="emoji">ğŸ”‘</span> Server Actionsçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</h4>
                    <ul>
                        <li><strong>å®‰å…¨æ€§</strong>ï¼šåœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼ŒSERVICE_ROLE_KEYä¸æš´éœ²</li>
                        <li><strong>æƒé™å®Œæ•´</strong>ï¼šå¯ä»¥è·³è¿‡RLSï¼Œæ‰§è¡Œä»»ä½•æ•°æ®åº“æ“ä½œ</li>
                        <li><strong>ç±»å‹å®‰å…¨</strong>ï¼šTypeScriptå…¨ç¨‹ç±»å‹æ£€æŸ¥</li>
                        <li><strong>è‡ªåŠ¨åºåˆ—åŒ–</strong>ï¼šå‚æ•°å’Œè¿”å›å€¼è‡ªåŠ¨åºåˆ—åŒ–</li>
                        <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ–‡ä»¶è¯¦è§£ï¼šsupabaseClient.ts -->
            <div class="section">
                <h2><span class="emoji">ğŸ”—</span> æ–‡ä»¶è¯¦è§£ï¼šsupabaseClient.ts - å®¢æˆ·ç«¯è¿æ¥</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "ğŸ–¥ï¸ å®¢æˆ·ç«¯è¿æ¥"
                                A[ğŸ“± Browser]
                                B[ğŸ”‘ ANON_KEY]
                                C[ğŸ“Š åªè¯»æŸ¥è¯¢]
                                D[ğŸ“¡ Realtimeç›‘å¬]
                            end
                            
                            subgraph "âš¡ æœåŠ¡ç«¯è¿æ¥"
                                E[ğŸ–¥ï¸ Node.js]
                                F[ğŸ” SERVICE_ROLE_KEY]
                                G[ğŸ“ å®Œæ•´CRUD]
                                H[ğŸš« è·³è¿‡RLS]
                            end
                            
                            subgraph "â˜ï¸ Supabase"
                                I[ğŸ—„ï¸ Database]
                                J[ğŸ“¡ Realtime]
                            end
                            
                            A --> B --> C --> I
                            A --> B --> D --> J
                            E --> F --> G --> I
                            E --> F --> H --> I
                            
                            style B fill:#22c55e
                            style F fill:#ef4444
                            style I fill:#3b82f6
                    </div>
                </div>
                
                <div class="code-block">
// ğŸ”— å®¢æˆ·ç«¯è¿æ¥é…ç½®
import { createClient } from '@supabase/supabase-js'

// ğŸŒ å®¢æˆ·ç«¯ï¼šä½¿ç”¨ANON_KEYï¼Œæƒé™å—é™
export const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,      // é¡¹ç›®URL
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!  // ğŸ‘¥ åŒ¿åå¯†é’¥
)

// ğŸ¯ ç”¨é€”ï¼š
// 1. ğŸ“Š æŸ¥è¯¢æ•°æ®ï¼ˆSELECTï¼‰
// 2. ğŸ“¡ ç›‘å¬Realtimeäº‹ä»¶
// 3. ğŸ›¡ï¸ å—RLSç­–ç•¥é™åˆ¶
// 4. ğŸ”’ æ— æ³•æ‰§è¡Œæ•æ„Ÿæ“ä½œ
                </div>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ç‰¹æ€§å¯¹æ¯”</th>
                            <th>å®¢æˆ·ç«¯è¿æ¥ï¼ˆANON_KEYï¼‰</th>
                            <th>æœåŠ¡ç«¯è¿æ¥ï¼ˆSERVICE_ROLE_KEYï¼‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>æ‰§è¡Œç¯å¢ƒ</strong></td>
                            <td>æµè§ˆå™¨</td>
                            <td>Node.jsæœåŠ¡å™¨</td>
                        </tr>
                        <tr>
                            <td><strong>æƒé™çº§åˆ«</strong></td>
                            <td>å—é™ï¼ˆéµå®ˆRLSï¼‰</td>
                            <td>å®Œæ•´ï¼ˆè·³è¿‡RLSï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>ä¸»è¦ç”¨é€”</strong></td>
                            <td>æŸ¥è¯¢æ•°æ®ã€ç›‘å¬å®æ—¶äº‹ä»¶</td>
                            <td>CRUDæ“ä½œã€æ•æ„Ÿæ•°æ®å¤„ç†</td>
                        </tr>
                        <tr>
                            <td><strong>å®‰å…¨æ€§</strong></td>
                            <td>å¯†é’¥å…¬å¼€ï¼Œæƒé™å—é™</td>
                            <td>å¯†é’¥ä¿å¯†ï¼Œæƒé™å®Œæ•´</td>
                        </tr>
                        <tr>
                            <td><strong>å®æ—¶åŠŸèƒ½</strong></td>
                            <td>âœ… æ”¯æŒ</td>
                            <td>âŒ ä¸éœ€è¦</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- æ–‡ä»¶è¯¦è§£ï¼šTodoForm.tsx -->
            <div class="section">
                <h2><span class="emoji">ğŸ“</span> æ–‡ä»¶è¯¦è§£ï¼šTodoForm.tsx - ä»»åŠ¡åˆ›å»ºè¡¨å•</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        flowchart TD
                            A[ğŸ‘¤ ç”¨æˆ·è¾“å…¥] --> B[ğŸ“ ReactçŠ¶æ€æ›´æ–°]
                            B --> C[âœ… è¡¨å•éªŒè¯]
                            C --> D{è¾“å…¥æ˜¯å¦æœ‰æ•ˆ?}
                            D -->|âœ… æœ‰æ•ˆ| E[âš¡ è°ƒç”¨Server Action]
                            D -->|âŒ æ— æ•ˆ| F[ğŸš« æ˜¾ç¤ºé”™è¯¯æç¤º]
                            E --> G[ğŸ”„ è®¾ç½®æäº¤çŠ¶æ€]
                            G --> H[ğŸ“¤ addTodo(content, userId)]
                            H --> I{æ“ä½œæ˜¯å¦æˆåŠŸ?}
                            I -->|âœ… æˆåŠŸ| J[ğŸ‰ æ¸…ç©ºè¡¨å•]
                            I -->|âŒ å¤±è´¥| K[âŒ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
                            J --> L[ğŸ“Š ç­‰å¾…Realtimeæ›´æ–°]
                            K --> M[ğŸ”„ é‡ç½®æäº¤çŠ¶æ€]
                            L --> M
                            
                            style E fill:#3b82f6
                            style J fill:#22c55e
                            style K fill:#ef4444
                    </div>
                </div>
                
                <div class="code-block">
'use client'  // ğŸ–¥ï¸ å®¢æˆ·ç«¯ç»„ä»¶

import { useState, useEffect } from 'react'
import { addTodo } from '../action'

export default function TodoForm() {
  // ğŸ  çŠ¶æ€ç®¡ç†
  const [input, setInput] = useState('')
  const [userId, setUserId] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)
  
  // ğŸ‘¤ ç”¨æˆ·IDåˆå§‹åŒ–ï¼ˆæ¼”ç¤ºç”¨éšæœºIDï¼‰
  useEffect(() => {
    let storedUserId = localStorage.getItem('demo_user_id')
    if (!storedUserId) {
      storedUserId = 'demo_user_' + Math.random().toString(36).substr(2, 9)
      localStorage.setItem('demo_user_id', storedUserId)
    }
    setUserId(storedUserId)
  }, [])
  
  // ğŸ“¤ è¡¨å•æäº¤å¤„ç†
  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault()
    if (!input.trim()) return
    
    setIsSubmitting(true)
    
    try {
      // âš¡ è°ƒç”¨Server Action
      const result = await addTodo(input.trim(), userId)
      
      if (!result.error) {
        setInput('')  // ğŸ§¹ æ¸…ç©ºè¡¨å•
      }
    } catch (error) {
      console.error('âŒ æäº¤é”™è¯¯:', error)
    } finally {
      setIsSubmitting(false)
    }
  }
}
                </div>
                
                <div class="warning-box">
                    <h4><span class="emoji">ğŸ¯</span> è®¾è®¡äº®ç‚¹ï¼š</h4>
                    <ul>
                        <li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šæäº¤æ—¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤æäº¤</li>
                        <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå®Œå–„çš„é”™è¯¯æ•è·å’Œç”¨æˆ·æç¤º</li>
                        <li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šæ¸…æ™°çš„ReactçŠ¶æ€ç®¡ç†</li>
                        <li><strong>æ¼”ç¤ºå‹å¥½</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆéšæœºç”¨æˆ·IDç”¨äºæ¼”ç¤º</li>
                        <li><strong>å“åº”å¼UI</strong>ï¼šç°ä»£åŒ–çš„è¡¨å•è®¾è®¡</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ–‡ä»¶è¯¦è§£ï¼šTodoList.tsx -->
            <div class="section">
                <h2><span class="emoji">ğŸ“‹</span> æ–‡ä»¶è¯¦è§£ï¼šTodoList.tsx - ä»»åŠ¡åˆ—è¡¨ç»„ä»¶</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TD
                            A[ğŸš€ ç»„ä»¶åŠ è½½] --> B[ğŸ‘¤ è·å–ç”¨æˆ·ID]
                            B --> C[ğŸ“Š åˆå§‹æ•°æ®åŠ è½½]
                            C --> D[ğŸ“¡ è®¾ç½®Realtimeç›‘å¬]
                            D --> E[ğŸ§ ç­‰å¾…æ•°æ®åº“äº‹ä»¶]
                            
                            E --> F{æ”¶åˆ°ä»€ä¹ˆäº‹ä»¶?}
                            F -->|ğŸ“ INSERT| G[â• æ·»åŠ æ–°ä»»åŠ¡åˆ°åˆ—è¡¨]
                            F -->|âœï¸ UPDATE| H[ğŸ”„ æ›´æ–°ç°æœ‰ä»»åŠ¡]
                            F -->|ğŸ—‘ï¸ DELETE| I[â– ä»åˆ—è¡¨ç§»é™¤ä»»åŠ¡]
                            
                            G --> J[ğŸ–¼ï¸ é‡æ–°æ¸²æŸ“UI]
                            H --> J
                            I --> J
                            
                            J --> E
                            
                            subgraph "ğŸ‘¤ ç”¨æˆ·æ“ä½œ"
                                K[âœ… ç‚¹å‡»å®Œæˆ]
                                L[ğŸ—‘ï¸ ç‚¹å‡»åˆ é™¤]
                                M[ğŸ”„ æ‰‹åŠ¨åˆ·æ–°]
                            end
                            
                            K --> N[âš¡ toggleDone Action]
                            L --> O[âš¡ removeTodo Action]
                            M --> P[ğŸ“Š é‡æ–°æŸ¥è¯¢æ•°æ®]
                            
                            N --> Q[ğŸ“¡ è§¦å‘UPDATEäº‹ä»¶]
                            O --> R[ğŸ“¡ è§¦å‘DELETEäº‹ä»¶]
                            P --> S[ğŸ”„ æ›´æ–°æœ¬åœ°çŠ¶æ€]
                            
                            Q --> F
                            R --> F
                            
                            style D fill:#f59e0b
                            style F fill:#3b82f6
                            style J fill:#22c55e
                    </div>
                </div>
                
                <div class="code-block">
'use client'

import { useEffect, useState } from 'react'
import { supabase } from '../lib/supabaseClient'
import { toggleDone, removeTodo } from '../action'

export default function TodoList() {
  const [todos, setTodos] = useState&lt;Todo[]&gt;([])
  const [userId, setUserId] = useState('')
  
  useEffect(() => {
    // 1ï¸âƒ£ è·å–ç”¨æˆ·ID
    const storedUserId = localStorage.getItem('demo_user_id')
    if (!storedUserId) return
    setUserId(storedUserId)
    
    // 2ï¸âƒ£ åˆå§‹æ•°æ®åŠ è½½
    const loadTodos = async () => {
      const { data } = await supabase
        .from('todos')
        .select('*')
        .eq('user_id', storedUserId)
        .order('created_at', { ascending: false })
      
      setTodos(data || [])
    }
    
    loadTodos()
    
    // 3ï¸âƒ£ è®¾ç½®Realtimeç›‘å¬
    const channel = supabase
      .channel('todos-changes')
      .on('postgres_changes', 
        { event: '*', schema: 'public', table: 'todos' },
        (payload) => {
          console.log('ğŸ”¥ æ”¶åˆ°å®æ—¶æ›´æ–°:', payload)
          
          const newData = payload.new as Todo
          const oldData = payload.old as Todo
          
          // 4ï¸âƒ£ æ ¹æ®äº‹ä»¶ç±»å‹æ›´æ–°æœ¬åœ°çŠ¶æ€
          if (payload.eventType === 'INSERT' && newData.user_id === storedUserId) {
            setTodos(prev => [newData, ...prev])
          } else if (payload.eventType === 'UPDATE' && newData.user_id === storedUserId) {
            setTodos(prev => prev.map(todo => 
              todo.id === newData.id ? newData : todo
            ))
          } else if (payload.eventType === 'DELETE') {
            setTodos(prev => prev.filter(todo => todo.id !== oldData.id))
          }
        }
      )
      .subscribe()
    
    // 5ï¸âƒ£ ç»„ä»¶å¸è½½æ—¶æ¸…ç†
    return () => {
      supabase.removeChannel(channel)
    }
  }, [])
}
                </div>
                
                <div class="success-box">
                    <h4><span class="emoji">ğŸ¯</span> Realtimeæ ¸å¿ƒæœºåˆ¶ï¼š</h4>
                    <ul>
                        <li><strong>WebSocketè¿æ¥</strong>ï¼šåŸºäºWebSocketçš„åŒå‘é€šä¿¡</li>
                        <li><strong>äº‹ä»¶ç›‘å¬</strong>ï¼šç›‘å¬INSERTã€UPDATEã€DELETEäº‹ä»¶</li>
                        <li><strong>å³æ—¶æ›´æ–°</strong>ï¼šæ•°æ®åº“å˜åŒ–ç«‹å³åæ˜ åˆ°UI</li>
                        <li><strong>ç”¨æˆ·è¿‡æ»¤</strong>ï¼šåªæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æ•°æ®</li>
                        <li><strong>å†…å­˜åŒæ­¥</strong>ï¼šæœ¬åœ°çŠ¶æ€ä¸æ•°æ®åº“ä¿æŒåŒæ­¥</li>
                    </ul>
                </div>
            </div>
            
            <!-- Supabase Realtimeæ·±åº¦è§£æ -->
            <div class="section">
                <h2><span class="emoji">ğŸ“¡</span> Supabase Realtimeæ·±åº¦è§£æ</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "ğŸ–¥ï¸ æµè§ˆå™¨A"
                                A1[ğŸ‘¤ ç”¨æˆ·Aæ“ä½œ]
                                A2[ğŸ“± TodoListç»„ä»¶]
                                A3[ğŸ”— WebSocketè¿æ¥A]
                            end
                            
                            subgraph "ğŸ–¥ï¸ æµè§ˆå™¨B"
                                B1[ğŸ‘¤ ç”¨æˆ·Bæ“ä½œ]
                                B2[ğŸ“± TodoListç»„ä»¶]
                                B3[ğŸ”— WebSocketè¿æ¥B]
                            end
                            
                            subgraph "âš¡ Next.js Server"
                                C1[ğŸ”§ Server Action]
                                C2[ğŸ” SERVICE_ROLE_KEY]
                            end
                            
                            subgraph "â˜ï¸ Supabase Cloud"
                                D1[ğŸ—„ï¸ PostgreSQLæ•°æ®åº“]
                                D2[ğŸ“¡ Realtime Engine]
                                D3[ğŸ§ LISTEN/NOTIFY]
                            end
                            
                            A1 --> C1
                            B1 --> C1
                            C1 --> C2
                            C2 --> D1
                            
                            D1 --> D3
                            D3 --> D2
                            
                            D2 --> A3
                            D2 --> B3
                            
                            A3 --> A2
                            B3 --> B2
                            
                            A2 -.->|ğŸ”„ çŠ¶æ€æ›´æ–°| A1
                            B2 -.->|ğŸ”„ çŠ¶æ€æ›´æ–°| B1
                            
                            style D2 fill:#f59e0b
                            style C1 fill:#3b82f6
                            style D1 fill:#22c55e
                    </div>
                </div>
                
                <div class="code-block">
// ğŸ”¥ Realtimeçš„åº•å±‚å·¥ä½œåŸç†

// 1ï¸âƒ£ PostgreSQLæ•°æ®åº“å±‚é¢
-- å½“æ‰§è¡ŒINSERT/UPDATE/DELETEæ—¶ï¼ŒPostgreSQLè‡ªåŠ¨å‘å‡ºNOTIFYäº‹ä»¶
INSERT INTO todos (content, user_id) VALUES ('æ–°ä»»åŠ¡', 'user123');
-- ğŸ‘† è¿™ä¸ªæ“ä½œä¼šè§¦å‘ä¸€ä¸ªNOTIFYäº‹ä»¶

// 2ï¸âƒ£ Supabase Realtime Engine
-- ç›‘å¬PostgreSQLçš„NOTIFYäº‹ä»¶
LISTEN todos_changes;
-- æ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡WebSocketå¹¿æ’­ç»™æ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯

// 3ï¸âƒ£ å®¢æˆ·ç«¯WebSocketç›‘å¬
const channel = supabase
  .channel('todos-changes')  // åˆ›å»ºä¸€ä¸ªé¢‘é“
  .on('postgres_changes', {  // ç›‘å¬æ•°æ®åº“å˜åŒ–
    event: '*',              // æ‰€æœ‰äº‹ä»¶ï¼ˆINSERT/UPDATE/DELETEï¼‰
    schema: 'public',        // æ•°æ®åº“æ¨¡å¼
    table: 'todos'           // ç›®æ ‡è¡¨
  }, (payload) => {
    // 4ï¸âƒ£ æ”¶åˆ°å®æ—¶äº‹ä»¶ï¼Œæ›´æ–°æœ¬åœ°çŠ¶æ€
    console.log('æ”¶åˆ°å®æ—¶æ›´æ–°:', payload)
    updateLocalState(payload)
  })
  .subscribe()               // å¼€å§‹ç›‘å¬
                </div>
                
                <div class="warning-box">
                    <h4><span class="emoji">âš¡</span> Realtimeæ€§èƒ½ç‰¹ç‚¹ï¼š</h4>
                    <ul>
                        <li><strong>æ¯«ç§’çº§å»¶è¿Ÿ</strong>ï¼šWebSocketæä¾›æ¥è¿‘å®æ—¶çš„æ›´æ–°</li>
                        <li><strong>è‡ªåŠ¨é‡è¿</strong>ï¼šç½‘ç»œæ–­å¼€åè‡ªåŠ¨é‡æ–°è¿æ¥</li>
                        <li><strong>äº‹ä»¶è¿‡æ»¤</strong>ï¼šå¯ä»¥æŒ‰è¡¨ã€åˆ—ã€ç”¨æˆ·ç­‰æ¡ä»¶è¿‡æ»¤</li>
                        <li><strong>æ‰¹é‡æ›´æ–°</strong>ï¼šå¤šä¸ªå¿«é€Ÿæ“ä½œä¼šè¢«åˆå¹¶å¤„ç†</li>
                        <li><strong>è·¨å¹³å°åŒæ­¥</strong>ï¼šWebã€ç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯éƒ½èƒ½å®æ—¶åŒæ­¥</li>
                    </ul>
                </div>
            </div>
            
            <!-- åŒå®¢æˆ·ç«¯æ¶æ„è¯¦è§£ -->
            <div class="section">
                <h2><span class="emoji">ğŸ”‘</span> åŒå®¢æˆ·ç«¯æ¶æ„ï¼šå®‰å…¨ä¸åŠŸèƒ½çš„å®Œç¾å¹³è¡¡</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "ğŸ”’ å®‰å…¨è¾¹ç•Œ"
                                A[ğŸŒ æµè§ˆå™¨ç¯å¢ƒ<br/>ä¸å®‰å…¨]
                                B[ğŸ–¥ï¸ æœåŠ¡å™¨ç¯å¢ƒ<br/>å®‰å…¨]
                            end
                            
                            subgraph "ğŸ‘¥ å®¢æˆ·ç«¯è¿æ¥"
                                C[ğŸ”‘ ANON_KEY<br/>å…¬å¼€å¯†é’¥]
                                D[ğŸ“Š æŸ¥è¯¢æƒé™]
                                E[ğŸ“¡ å®æ—¶ç›‘å¬]
                                F[ğŸ›¡ï¸ RLSä¿æŠ¤]
                            end
                            
                            subgraph "âš¡ æœåŠ¡ç«¯è¿æ¥"
                                G[ğŸ” SERVICE_ROLE_KEY<br/>æœºå¯†å¯†é’¥]
                                H[ğŸ“ å®Œæ•´CRUDæƒé™]
                                I[ğŸš« è·³è¿‡RLS]
                                J[ğŸ›¡ï¸ æœåŠ¡å™¨ç«¯æ‰§è¡Œ]
                            end
                            
                            A --> C
                            C --> D
                            C --> E
                            D --> F
                            
                            B --> G
                            G --> H
                            G --> I
                            H --> J
                            
                            style A fill:#fef2f2
                            style B fill:#f0fdf4
                            style C fill:#dbeafe
                            style G fill:#fee2e2
                    </div>
                </div>
                
                <div class="info-box">
                    <h4><span class="emoji">ğŸ¯</span> ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Ÿ</h4>
                    
                    <h4><span class="emoji">ğŸ›¡ï¸</span> å®‰å…¨è€ƒè™‘</h4>
                    <ul>
                        <li><strong>å¯†é’¥åˆ†ç¦»</strong>ï¼šæ•æ„Ÿçš„SERVICE_ROLE_KEYæ°¸è¿œä¸æš´éœ²ç»™æµè§ˆå™¨</li>
                        <li><strong>æƒé™æœ€å°åŒ–</strong>ï¼šå®¢æˆ·ç«¯åªæœ‰æŸ¥è¯¢æƒé™ï¼Œå†™æ“ä½œåœ¨æœåŠ¡ç«¯</li>
                        <li><strong>æ”»å‡»é¢ç¼©å°</strong>ï¼šå³ä½¿å®¢æˆ·ç«¯è¢«æ”»å‡»ï¼Œä¹Ÿæ— æ³•è¿›è¡Œç ´åæ€§æ“ä½œ</li>
                    </ul>
                    
                    <h4><span class="emoji">âš¡</span> åŠŸèƒ½éœ€æ±‚</h4>
                    <ul>
                        <li><strong>å®æ—¶åŠŸèƒ½</strong>ï¼šå®¢æˆ·ç«¯éœ€è¦WebSocketè¿æ¥ç›‘å¬å˜åŒ–</li>
                        <li><strong>æŸ¥è¯¢æ€§èƒ½</strong>ï¼šå®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼ŒæŸ¥è¯¢æ›´å¿«</li>
                        <li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šå³æ—¶æ˜¾ç¤ºæ•°æ®ï¼Œæ— éœ€ç­‰å¾…æœåŠ¡å™¨å“åº”</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ—ï¸</span> æ¶æ„ä¼˜åŠ¿</h4>
                    <ul>
                        <li><strong>èŒè´£åˆ†ç¦»</strong>ï¼šæŸ¥è¯¢å’Œå†™æ“ä½œåˆ†ç¦»ï¼Œä»£ç æ›´æ¸…æ™°</li>
                        <li><strong>æ‰©å±•æ€§å¥½</strong>ï¼šå¯ä»¥ç‹¬ç«‹ä¼˜åŒ–æŸ¥è¯¢å’Œå†™æ“ä½œ</li>
                        <li><strong>å®‰å…¨æ€§é«˜</strong>ï¼šå…³é”®æ“ä½œåœ¨å—ä¿æŠ¤çš„æœåŠ¡å™¨ç¯å¢ƒä¸­æ‰§è¡Œ</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ•°æ®åº“è®¾è®¡è¯¦è§£ -->
            <div class="section">
                <h2><span class="emoji">ğŸ—„ï¸</span> æ•°æ®åº“è®¾è®¡è¯¦è§£</h2>
                
                <div class="code-block">
-- ğŸ“‹ todosè¡¨ç»“æ„è®¾è®¡
CREATE TABLE todos (
  id BIGSERIAL PRIMARY KEY,              -- ğŸ”¢ è‡ªå¢ä¸»é”®
  content TEXT NOT NULL,                 -- ğŸ“ ä»»åŠ¡å†…å®¹
  done BOOLEAN DEFAULT FALSE,            -- âœ… å®ŒæˆçŠ¶æ€
  user_id TEXT NOT NULL,                 -- ğŸ‘¤ ç”¨æˆ·IDï¼ˆæ¼”ç¤ºç”¨å­—ç¬¦ä¸²ï¼‰
  created_at TIMESTAMPTZ DEFAULT NOW(), -- ğŸ“… åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMPTZ DEFAULT NOW()  -- ğŸ”„ æ›´æ–°æ—¶é—´
);

-- ğŸš€ æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_todos_user_id ON todos(user_id);
CREATE INDEX idx_todos_created_at ON todos(created_at DESC);

-- ğŸ›¡ï¸ è¡Œçº§å®‰å…¨ï¼ˆRLSï¼‰ç­–ç•¥è®¾ç½®
-- å¼€å‘ç¯å¢ƒæš‚æ—¶ç¦ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒå¯å¯ç”¨
ALTER TABLE todos DISABLE ROW LEVEL SECURITY;

-- ğŸ¯ å¯é€‰çš„RLSç­–ç•¥ç¤ºä¾‹
-- CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®" ON todos
--   FOR ALL USING (auth.uid()::text = user_id);
                </div>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>å­—æ®µå</th>
                            <th>æ•°æ®ç±»å‹</th>
                            <th>ä½œç”¨</th>
                            <th>è®¾è®¡è€ƒè™‘</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>BIGSERIAL</td>
                            <td>å”¯ä¸€æ ‡è¯†</td>
                            <td>è‡ªå¢ï¼Œæ”¯æŒæµ·é‡æ•°æ®</td>
                        </tr>
                        <tr>
                            <td><code>content</code></td>
                            <td>TEXT</td>
                            <td>ä»»åŠ¡å†…å®¹</td>
                            <td>æ— é•¿åº¦é™åˆ¶ï¼Œæ”¯æŒé•¿æ–‡æœ¬</td>
                        </tr>
                        <tr>
                            <td><code>done</code></td>
                            <td>BOOLEAN</td>
                            <td>å®ŒæˆçŠ¶æ€</td>
                            <td>ç®€å•å¸ƒå°”å€¼ï¼Œé«˜æ•ˆæŸ¥è¯¢</td>
                        </tr>
                        <tr>
                            <td><code>user_id</code></td>
                            <td>TEXT</td>
                            <td>ç”¨æˆ·æ ‡è¯†</td>
                            <td>æ¼”ç¤ºç”¨å­—ç¬¦ä¸²ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨UUID</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMPTZ</td>
                            <td>åˆ›å»ºæ—¶é—´</td>
                            <td>åŒ…å«æ—¶åŒºï¼Œæ”¯æŒå…¨çƒç”¨æˆ·</td>
                        </tr>
                        <tr>
                            <td><code>updated_at</code></td>
                            <td>TIMESTAMPTZ</td>
                            <td>æ›´æ–°æ—¶é—´</td>
                            <td>å¯ç”¨äºå†²çªè§£å†³å’Œç‰ˆæœ¬æ§åˆ¶</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- å®æ—¶åŒæ­¥çš„é«˜çº§ç‰¹æ€§ -->
            <div class="section">
                <h2><span class="emoji">ğŸ¯</span> å®æ—¶åŒæ­¥çš„é«˜çº§ç‰¹æ€§</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TD
                            A[ğŸ“± ç”¨æˆ·æ“ä½œ] --> B{æ“ä½œç±»å‹}
                            
                            B -->|ğŸ“ CREATE| C[âš¡ addTodo Action]
                            B -->|âœï¸ UPDATE| D[âš¡ toggleDone Action]
                            B -->|ğŸ—‘ï¸ DELETE| E[âš¡ removeTodo Action]
                            
                            C --> F[ğŸ—„ï¸ INSERTåˆ°æ•°æ®åº“]
                            D --> G[ğŸ—„ï¸ UPDATEæ•°æ®åº“]
                            E --> H[ğŸ—„ï¸ DELETEæ•°æ®åº“]
                            
                            F --> I[ğŸ“¡ INSERTäº‹ä»¶]
                            G --> J[ğŸ“¡ UPDATEäº‹ä»¶]  
                            H --> K[ğŸ“¡ DELETEäº‹ä»¶]
                            
                            I --> L{ç”¨æˆ·è¿‡æ»¤}
                            J --> L
                            K --> L
                            
                            L -->|âœ… å½“å‰ç”¨æˆ·| M[â• æ·»åŠ åˆ°åˆ—è¡¨]
                            L -->|âœ… å½“å‰ç”¨æˆ·| N[ğŸ”„ æ›´æ–°åˆ—è¡¨é¡¹]
                            L -->|â“ ä»»æ„ç”¨æˆ·| O[â– ç§»é™¤åˆ—è¡¨é¡¹]
                            
                            M --> P[ğŸ–¼ï¸ UIé‡æ–°æ¸²æŸ“]
                            N --> P
                            O --> P
                            
                            style I fill:#22c55e
                            style J fill:#f59e0b
                            style K fill:#ef4444
                            style L fill:#3b82f6
                    </div>
                </div>
                
                <div class="code-block">
// ğŸ¯ é«˜çº§è¿‡æ»¤ï¼šåªç›‘å¬ç‰¹å®šç”¨æˆ·çš„æ•°æ®å˜åŒ–
const channel = supabase
  .channel('user-todos')
  .on('postgres_changes', {
    event: '*',
    schema: 'public', 
    table: 'todos',
    filter: `user_id=eq.${userId}`  // ğŸ¯ åªç›‘å¬å½“å‰ç”¨æˆ·çš„å˜åŒ–
  }, handleRealtimeEvent)
  .subscribe()

// ğŸ”„ äº‹ä»¶å¤„ç†å™¨ï¼šæ ¹æ®äº‹ä»¶ç±»å‹æ›´æ–°æœ¬åœ°çŠ¶æ€
const handleRealtimeEvent = (payload) => {
  const { eventType, new: newData, old: oldData } = payload
  
  switch (eventType) {
    case 'INSERT':
      // â• æ–°ä»»åŠ¡ï¼šæ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨
      setTodos(prev => [newData, ...prev])
      break
      
    case 'UPDATE':
      // ğŸ”„ æ›´æ–°ä»»åŠ¡ï¼šæ›¿æ¢å¯¹åº”é¡¹ç›®
      setTodos(prev => prev.map(todo => 
        todo.id === newData.id ? newData : todo
      ))
      break
      
    case 'DELETE':
      // ğŸ—‘ï¸ åˆ é™¤ä»»åŠ¡ï¼šä»åˆ—è¡¨ç§»é™¤
      setTodos(prev => prev.filter(todo => todo.id !== oldData.id))
      break
  }
}

// ğŸ§¹ ç»„ä»¶å¸è½½æ—¶æ¸…ç†è¿æ¥
useEffect(() => {
  return () => {
    supabase.removeChannel(channel)
  }
}, [])
                </div>
            </div>
            
            <!-- é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ -->
            <div class="section">
                <h2><span class="emoji">ğŸ› ï¸</span> é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        flowchart TD
                            A[ğŸ‘¤ ç”¨æˆ·æ“ä½œ] --> B{ç½‘ç»œçŠ¶æ€}
                            
                            B -->|ğŸŒ åœ¨çº¿| C[ğŸ“¡ æ­£å¸¸æ‰§è¡Œ]
                            B -->|ğŸ“¡ ç¦»çº¿| D[â³ æ“ä½œé˜Ÿåˆ—]
                            
                            C --> E{æ“ä½œç»“æœ}
                            E -->|âœ… æˆåŠŸ| F[ğŸ‰ UIå³æ—¶æ›´æ–°]
                            E -->|âŒ å¤±è´¥| G[ğŸ”„ é”™è¯¯å¤„ç†]
                            
                            D --> H[ğŸ“¶ ç½‘ç»œæ¢å¤]
                            H --> I[ğŸ”„ é‡è¯•é˜Ÿåˆ—ä¸­çš„æ“ä½œ]
                            
                            G --> J[ğŸš¨ é”™è¯¯æç¤º]
                            G --> K[ğŸ”„ æä¾›é‡è¯•é€‰é¡¹]
                            
                            I --> E
                            
                            F --> L[ğŸ“Š ç”¨æˆ·åé¦ˆ]
                            J --> L
                            
                            style F fill:#22c55e
                            style G fill:#ef4444
                            style D fill:#f59e0b
                    </div>
                </div>
                
                <div class="success-box">
                    <h4><span class="emoji">âœ¨</span> ç”¨æˆ·ä½“éªŒä¼˜åŒ–ç­–ç•¥ï¼š</h4>
                    
                    <h4><span class="emoji">âš¡</span> å³æ—¶åé¦ˆ</h4>
                    <ul>
                        <li><strong>ä¹è§‚æ›´æ–°</strong>ï¼šæ“ä½œç«‹å³åæ˜ åœ¨UIä¸Š</li>
                        <li><strong>åŠ è½½çŠ¶æ€</strong>ï¼šæäº¤æ—¶æ˜¾ç¤ºloadingæŒ‡ç¤ºå™¨</li>
                        <li><strong>é”™è¯¯å›æ»š</strong>ï¼šæ“ä½œå¤±è´¥æ—¶æ¢å¤åŸçŠ¶æ€</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ”„</span> ç½‘ç»œå¤„ç†</h4>
                    <ul>
                        <li><strong>è‡ªåŠ¨é‡è¿</strong>ï¼šWebSocketæ–­å¼€åè‡ªåŠ¨é‡è¿</li>
                        <li><strong>ç¦»çº¿æ”¯æŒ</strong>ï¼šç¦»çº¿æ—¶ç¼“å­˜æ“ä½œ</li>
                        <li><strong>åŒæ­¥æœºåˆ¶</strong>ï¼šç½‘ç»œæ¢å¤ååŒæ­¥æœªå®Œæˆæ“ä½œ</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ›¡ï¸</span> é”™è¯¯å¤„ç†</h4>
                    <ul>
                        <li><strong>å‹å¥½æç¤º</strong>ï¼šç”¨æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šé”™è¯¯</li>
                        <li><strong>é‡è¯•æœºåˆ¶</strong>ï¼šæä¾›æ‰‹åŠ¨é‡è¯•é€‰é¡¹</li>
                        <li><strong>é™çº§å¤„ç†</strong>ï¼šå…³é”®åŠŸèƒ½å¤±æ•ˆæ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ -->
            <div class="section">
                <h2><span class="emoji">ğŸš€</span> æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2>
                
                <div class="chart-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "ğŸ¯ å‰ç«¯ä¼˜åŒ–"
                                A[ğŸ”„ React.memo()]
                                B[ğŸ“¦ çŠ¶æ€æœ€å°åŒ–]
                                C[ğŸ£ useCallbacké’©å­]
                                D[âš¡ è™šæ‹Ÿåˆ—è¡¨]
                            end
                            
                            subgraph "ğŸ“¡ ç½‘ç»œä¼˜åŒ–"
                                E[ğŸŒ WebSocketå¤ç”¨]
                                F[ğŸ“Š äº‹ä»¶æ‰¹å¤„ç†]
                                G[ğŸ¯ é€‰æ‹©æ€§è®¢é˜…]
                                H[ğŸ’¾ æœ¬åœ°ç¼“å­˜]
                            end
                            
                            subgraph "ğŸ—„ï¸ æ•°æ®åº“ä¼˜åŒ–"
                                I[ğŸ“ˆ ç´¢å¼•ä¼˜åŒ–]
                                J[ğŸ” æŸ¥è¯¢ä¼˜åŒ–]
                                K[ğŸ“Š åˆ†é¡µåŠ è½½]
                                L[ğŸ¯ å­—æ®µé€‰æ‹©]
                            end
                            
                            subgraph "â˜ï¸ æœåŠ¡ç«¯ä¼˜åŒ–"
                                M[âš¡ Server Actions]
                                N[ğŸ” è¿æ¥æ± ]
                                O[ğŸ“¦ æ•°æ®å‹ç¼©]
                                P[ğŸš€ CDNåŠ é€Ÿ]
                            end
                            
                            style A fill:#22c55e
                            style E fill:#3b82f6
                            style I fill:#f59e0b
                            style M fill:#8b5cf6
                    </div>
                </div>
                
                <div class="code-block">
// ğŸ¯ æ€§èƒ½ä¼˜åŒ–å®è·µä»£ç ç¤ºä¾‹

// 1ï¸âƒ£ Reactç»„ä»¶ä¼˜åŒ–
const TodoItem = React.memo(({ todo, onToggle, onDelete }) => {
  // åªæœ‰todoæ•°æ®å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“
  return (
    &lt;div&gt;
      &lt;span&gt;{todo.content}&lt;/span&gt;
      &lt;button onClick={() => onToggle(todo.id, todo.done)}&gt;
        {todo.done ? 'âœ…' : 'â­•'}
      &lt;/button&gt;
    &lt;/div&gt;
  )
})

// 2ï¸âƒ£ äº‹ä»¶å¤„ç†ä¼˜åŒ–
const handleToggle = useCallback((id, done) => {
  // é¿å…å‡½æ•°é‡å¤åˆ›å»º
  toggleDone(id, done)
}, [])

// 3ï¸âƒ£ æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
const { data } = await supabase
  .from('todos')
  .select('id, content, done, created_at')  // ğŸ¯ åªé€‰æ‹©éœ€è¦çš„å­—æ®µ
  .eq('user_id', userId)
  .order('created_at', { ascending: false })
  .limit(50)                                // ğŸ“Š åˆ†é¡µé™åˆ¶

// 4ï¸âƒ£ Realtimeäº‹ä»¶è¿‡æ»¤
const channel = supabase
  .channel('todos')
  .on('postgres_changes', {
    event: '*',
    schema: 'public',
    table: 'todos',
    filter: `user_id=eq.${userId}`          // ğŸ¯ åªç›‘å¬ç›¸å…³æ•°æ®
  }, handleChange)
                </div>
            </div>
            
            <!-- æ€»ç»“ -->
            <div class="section">
                <h2><span class="emoji">ğŸ‰</span> æ€»ç»“ï¼šç°ä»£å…¨æ ˆå®æ—¶åº”ç”¨çš„æ ¸å¿ƒä»·å€¼</h2>
                
                <div class="success-box">
                    <h4><span class="emoji">ğŸ†</span> æŠ€æœ¯ä»·å€¼ï¼š</h4>
                    
                    <h4><span class="emoji">ğŸ”—</span> å‰æ²¿æŠ€æœ¯æ ˆ</h4>
                    <ul>
                        <li><strong>Next.js 15</strong>ï¼šæœ€æ–°çš„Reactå…¨æ ˆæ¡†æ¶</li>
                        <li><strong>Server Actions</strong>ï¼šç®€åŒ–çš„æœåŠ¡ç«¯é€»è¾‘</li>
                        <li><strong>Supabase Realtime</strong>ï¼šä¼ä¸šçº§å®æ—¶æ•°æ®åº“</li>
                        <li><strong>TypeScript</strong>ï¼šç±»å‹å®‰å…¨çš„å¼€å‘ä½“éªŒ</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ—ï¸</span> æ¶æ„ä¼˜åŠ¿</h4>
                    <ul>
                        <li><strong>åŒå®¢æˆ·ç«¯è®¾è®¡</strong>ï¼šå®‰å…¨æ€§ä¸æ€§èƒ½å¹¶é‡</li>
                        <li><strong>å®æ—¶åŒæ­¥</strong>ï¼šæ¯«ç§’çº§çš„æ•°æ®åŒæ­¥</li>
                        <li><strong>ç»„ä»¶åŒ–å¼€å‘</strong>ï¼šå¯ç»´æŠ¤çš„ä»£ç ç»“æ„</li>
                        <li><strong>å£°æ˜å¼UI</strong>ï¼šç›´è§‚çš„çŠ¶æ€ç®¡ç†</li>
                    </ul>
                    
                    <h4><span class="emoji">ğŸ’¼</span> å•†ä¸šä»·å€¼</h4>
                    <ul>
                        <li><strong>å¼€å‘æ•ˆç‡</strong>ï¼šå¿«é€Ÿæ„å»ºç°ä»£åº”ç”¨</li>
                        <li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šæµç•…çš„å®æ—¶åä½œ</li>
                        <li><strong>æ‰©å±•æ€§</strong>ï¼šæ”¯æŒæµ·é‡ç”¨æˆ·å¹¶å‘</li>
                        <li><strong>ç»´æŠ¤æˆæœ¬</strong>ï¼šç®€åŒ–çš„éƒ¨ç½²å’Œè¿ç»´</li>
                    </ul>
                </div>
                
                <div class="warning-box">
                    <h4><span class="emoji">ğŸ¯</span> å­¦ä¹ é‡ç‚¹å›é¡¾ï¼š</h4>
                    
                    <div class="step-list">
                        <ol>
                            <li><span class="emoji">ğŸ—ï¸</span> <strong>ç†è§£åŒå®¢æˆ·ç«¯æ¶æ„</strong>ï¼šå®¢æˆ·ç«¯æŸ¥è¯¢ + æœåŠ¡ç«¯æ“ä½œ</li>
                            <li><span class="emoji">ğŸ“¡</span> <strong>æŒæ¡Realtimeæœºåˆ¶</strong>ï¼šWebSocket + PostgreSQL NOTIFY</li>
                            <li><span class="emoji">âš¡</span> <strong>è¿ç”¨Server Actions</strong>ï¼šå®‰å…¨çš„æœåŠ¡ç«¯å‡½æ•°è°ƒç”¨</li>
                            <li><span class="emoji">ğŸ”„</span> <strong>å®ç°çŠ¶æ€åŒæ­¥</strong>ï¼šæœ¬åœ°çŠ¶æ€ä¸æ•°æ®åº“çš„å®æ—¶åŒæ­¥</li>
                            <li><span class="emoji">ğŸ›¡ï¸</span> <strong>ä¿è¯æ•°æ®å®‰å…¨</strong>ï¼šå¯†é’¥åˆ†ç¦» + æƒé™æ§åˆ¶</li>
                            <li><span class="emoji">ğŸ¨</span> <strong>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</strong>ï¼šåŠ è½½çŠ¶æ€ + é”™è¯¯å¤„ç†</li>
                        </ol>
                    </div>
                </div>
                
                <div class="info-box">
                    <h4><span class="emoji">ğŸš€</span> æ‰©å±•æ–¹å‘ï¼š</h4>
                    <ul>
                        <li><strong>ç”¨æˆ·è®¤è¯</strong>ï¼šé›†æˆSupabase Authå®ç°çœŸå®ç”¨æˆ·ç³»ç»Ÿ</li>
                        <li><strong>åä½œåŠŸèƒ½</strong>ï¼šæ·»åŠ ä»»åŠ¡åˆ†äº«ã€è¯„è®ºã€æ ‡ç­¾ç­‰åŠŸèƒ½</li>
                        <li><strong>ç¦»çº¿æ”¯æŒ</strong>ï¼šService Worker + IndexedDBå®ç°ç¦»çº¿èƒ½åŠ›</li>
                        <li><strong>ç§»åŠ¨ç«¯</strong>ï¼šReact Nativeç‰ˆæœ¬å®ç°è·¨å¹³å°åŒæ­¥</li>
                        <li><strong>AIé›†æˆ</strong>ï¼šæ™ºèƒ½ä»»åŠ¡æ¨èå’Œè‡ªåŠ¨åˆ†ç±»</li>
                    </ul>
                </div>
            </div>
            
            <!-- é¡µè„š -->
            <div class="section">
                <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 8px; margin-top: 40px;">
                    <p><strong><span class="emoji">ğŸ“</span> æ–‡æ¡£ç‰ˆæœ¬</strong>ï¼šDay13 - Supabase å®æ—¶Todoåº”ç”¨åŸç†è¯¦è§£</p>
                    <p><strong><span class="emoji">ğŸ“…</span> åˆ›å»ºæ—¥æœŸ</strong>ï¼š2025å¹´1æœˆ</p>
                    <p><strong><span class="emoji">ğŸš€</span> é¡¹ç›®</strong>ï¼šNext.js 30å¤©å­¦ä¹ ä¹‹æ—…</p>
                    <p style="margin-top: 15px; color: #666;">
                        å¸Œæœ›è¿™ä¸ªè¯¦ç»†çš„è§£æå¸®åŠ©æ‚¨å®Œå…¨ç†è§£ç°ä»£å…¨æ ˆå®æ—¶åº”ç”¨çš„å·¥ä½œåŸç†ï¼<span class="emoji">ğŸ‰</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ– Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
        
        // æ·»åŠ ç‚¹å‡»å›¾è¡¨å¤åˆ¶åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const charts = document.querySelectorAll('.mermaid');
            charts.forEach(chart => {
                chart.style.cursor = 'pointer';
                chart.title = 'ç‚¹å‡»å¤åˆ¶å›¾è¡¨æºç ';
                chart.addEventListener('click', function() {
                    const text = this.textContent.trim();
                    navigator.clipboard.writeText(text).then(() => {
                        const originalTitle = this.title;
                        this.title = 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼';
                        setTimeout(() => {
                            this.title = originalTitle;
                        }, 2000);
                    });
                });
            });
            
            // æ·»åŠ ä»£ç å—å¤åˆ¶åŠŸèƒ½
            const codeBlocks = document.querySelectorAll('.code-block');
            codeBlocks.forEach(block => {
                block.style.cursor = 'pointer';
                block.title = 'ç‚¹å‡»å¤åˆ¶ä»£ç ';
                block.addEventListener('click', function() {
                    const text = this.textContent.trim();
                    navigator.clipboard.writeText(text).then(() => {
                        const originalBg = this.style.backgroundColor;
                        this.style.backgroundColor = '#059669';
                        setTimeout(() => {
                            this.style.backgroundColor = originalBg;
                        }, 1000);
                    });
                });
            });
        });
        
        // æ·»åŠ å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html> 